#!/usr/bin/env bash
# Script that configures a new Ubuntu machine to
# redirect /redirect_me with a 301 status

# Update package list and install Nginx
sudo apt-get update
sudo apt-get install -y nginx

# Create a default index.html file
echo "Hello World!" | sudo tee /var/www/html/index.html > /dev/null

CONFIG_FILE="/etc/nginx/sites-available/default"

# Add the redirect using a location block after server_name
sudo sed -i '/server_name _;/a \\n\tlocation = /redirect_me {\n\t\treturn 301 https://github.com/El-gibbor;\n\t}' "$CONFIG_FILE"

# Test the Nginx configuration
sudo nginx -t || { echo "Nginx configuration test failed"; exit 1; }

# Restart Nginx to apply changes
sudo service nginx restart
